@(record: Record, warn: Option[Html]=None)(implicit cfg: Configuration, req: RequestHeader=null, admin: Boolean=false)

@import comps._
@import java.time.format.DateTimeFormatter
@import qxsl.field._

@summ = @{Tables(record.file,record.sect).score}
@mail = @{cfg.get[String]("contest.mail")}
@dfmt = @{DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")}
@time(t: Time)=@{t.value.format(dfmt)}

@comps.frame(title="提出書類の確認", nav=if(admin) "admin" else "entry") {
@if(admin && warn.nonEmpty) {
<div class="alert alert-danger">
	<span class="glyphicon glyphicon-warning-sign"></span> @warn
</div>
} else {
<div class="alert alert-info">
	下記の内容で受理しました。
	交信記録が正しく読み込まれたかご確認ください。
	訂正が必要な場合は期間内に限り再提出できます。
</div>
}
<div class="par panel panel-default">
	<div class="panel-heading">
		<h3>@record.sect</h3>
	</div>
	<table class="table">
		<tr>
			<th>呼出符号</th>
			<th>運用場所</th>
			<th>お名前</th>
			<th>ご住所</th>
			<th>メール</th>
		</tr>
		<tr>
			<td>@record.call</td>
			<td>@record.city</td>
			<td>@record.name</td>
			<td>@if(admin) {**********} else {@record.addr}</td>
			<td>@record.mail</td>
		</tr>
	</table>
@if(record.comm.nonEmpty) {
	<div class="panel-footer">
		@record.comm
	</div>
}
</div>
<div class="par panel panel-default">
	<div class="panel-heading">
		<h3>暫定の得点</h3>
	</div>
	<div class="panel-body">
		<strong>@{summ.total}点</strong> (素点@summ.score 乗数@summ.mults)
	</div>
</div>
<div class="par panel panel-default">
	<div class="panel-heading">
		<h3>有効な交信</h3>
	</div>
	<table class="table table-hover">
		<tr>
			<th width="26%">交信日時</th>
			<th width="16%">相手局</th>
			<th width="16%">周波数帯</th>
			<th width="16%">通信方式</th>
			<th width="16%">運用地</th>
		</tr>
	@for(succ <- summ.accepted()) {
		<tr>
			<td>@{time(succ.item.get(classOf[Time]))}</td>
			<td>@{succ.item.get(classOf[Call])}</td>
			<td>@{succ.item.get(classOf[Band])}</td>
			<td>@{succ.item.get(classOf[Mode])}</td>
			<td>@{succ.item.getRcvd.get(classOf[Code])}</td>
		</tr>
	}
	</table>
</div>
<div class="par panel panel-default">
	<div class="panel-heading">
		<h3>無効な交信</h3>
	</div>
	<table class="table table-hover">
		<tr>
			<th width="26%">交信日時</th>
			<th width="16%">相手局</th>
			<th width="16%">周波数帯</th>
			<th width="16%">通信方式</th>
			<th width="16%">運用地</th>
		</tr>
	@for(fail <- summ.rejected()) {
		<tr>
			<td>@{time(fail.item.get(classOf[Time]))}</td>
			<td>@{fail.item.get(classOf[Call])}</td>
			<td>@{fail.item.get(classOf[Band])}</td>
			<td>@{fail.item.get(classOf[Mode])}</td>
			<td>@{fail.item.getRcvd.get(classOf[Code])}</td>
		</tr>
	}
	</table>
	<div class="panel-footer">
		時間外の交信や部門外の周波数帯など、書類の不備により、得点計算の対象と認められない交信です。
	</div>
</div>
@if(admin) {
@helper.form(action=routes.Admin.post(record.id), 'class->"form-horizontal", 'enctype->"multipart/form-data") {
@helper.CSRF.formField
@accord(id="edit", title="内容の修正", header=3) {
@upload(id="sheet", name="sheet", hint="交信記録を更新すると参加者にメール通知されます。")
<a class="btn btn-default" href="@routes.Admin.logs(record.id)"><span class="glyphicon glyphicon-download"></span> ダウンロード</a>
<button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-upload"></span> アップロード</button>
}
}
} else {
<a class="btn btn-lg btn-primary" onclick="window.print()"><span class="glyphicon glyphicon-print"></span> 印刷する</a>
<a class="btn btn-lg btn-default" href="mailto:@mail"><span class="glyphicon glyphicon-envelope"></span> 不具合を報告</a>
}
}
